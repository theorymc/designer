<!doctype html>
<html>
    <head>
        <style>
            .object {
                position: absolute;
                transform-style: preserve-3d;
                transform-origin: 50% 50% 50%;
            }

            .surface {
                left: 50%;
                top: 50%;
                margin-top: -320px;
                margin-left: -320px;
                width: 640px;
                height: 640px;
                /*outline: 1px solid rgba(0, 0, 0, 0.3);
                background: rgba(0, 0, 0, 0.1);*/
                backface-visibility: visible;
                transform: rotateX(60deg) rotateY(0) rotateZ(60deg);
                box-sizing: border-box;
            }

            .block {
                transform-origin: 0 0 0;
            }

            .block:hover .face {
                outline: 1px solid rgba(255, 0, 0, 1);
            }

            .face {
                outline: 1px solid rgba(0, 0, 0, 0.3);
                backface-visibility: hidden;
            }
        </style>
    </head>
    <body class="selection">
        <input type="number" class="rotate-x" value="60" />
        <input type="number" class="rotate-y" value="0" />
        <input type="number" class="rotate-z" value="60" />
        <script src="jquery.js"></script>
        <script>
            Array.prototype.random = function() {
                return this[Math.floor(Math.random() * this.length)];
            };

            Number.prototype.toInt = function() {
                return parseInt(this, 10);
            };

            var grid = 64;

            var textures = [
                "resources/textures/64x64/cobblestone-1.png",
                "resources/textures/64x64/cobblestone-2.png",
                "resources/textures/64x64/cobblestone-3.png",
                "resources/textures/64x64/cobblestone-4.png",
                "resources/textures/64x64/cobblestone-5.png",
                "resources/textures/64x64/cobblestone-6.png",
                "resources/textures/64x64/cobblestone-7.png",
                "resources/textures/64x64/cobblestone-8.png",
                "resources/textures/64x64/cobblestone-9.png",
                "resources/textures/64x64/cobblestone-10.png",
                "resources/textures/64x64/cobblestone-11.png",
            ];

            function Block(x, y, z, rx, ry, rz, type) {
                this.x = x || 0;
                this.y = y || 0;
                this.z = z || 0;
                this.rx = rx || 0;
                this.ry = ry || 0;
                this.rz = rz || 0;
                this.type = type || "dirt";

                this.ox = 0;
                this.oy = 0;
                this.oz = 0;
                this.orx = 0;
                this.ory = 0;
                this.orz = 0;

                this.element = this.createElement();
                this.update();
            }

            Block.prototype.update = function() {
                var x = (this.x * grid) + this.ox;
                var y = (this.y * grid) + this.oy;
                var z = (this.z * grid) + this.oz;

                var rx = this.rx + this.orx;
                var ry = this.ry + this.ory;
                var rz = this.rz + this.orz;

                this.element.css({
                    "width": grid + "px",
                    "height": grid + "px",
                    "left": (x + (grid / 2)) + "px",
                    "top": (y + (grid / 2)) + "px",
                    "transform": "translateZ(" + (z + (grid / 2)) + "px) rotateX(" + rx + "deg) rotateY(" + ry + "deg) rotateZ(" + rz + "deg) scale(0.99)"
                });
            };

            Block.prototype.createElement = function() {
                var element = $("<div />");

                element.data("block", this);
                element.addClass("object");
                element.addClass("block");

                element.append(this.createElementFace(textures.random(), grid, 0, 0, grid / 2, 0, 0, 0).data("side", "top"));
                element.append(this.createElementFace(textures.random(), grid, 0, grid / 2, 0, 270, 0, 0).data("side", "side-1"));
                element.append(this.createElementFace(textures.random(), grid, 0, grid / -2, 0, 90, 0, 0).data("side", "side-2"));
                element.append(this.createElementFace(textures.random(), grid, grid / 2, 0, 0, 0, 90, 0).data("side", "side-3"));
                element.append(this.createElementFace(textures.random(), grid, grid / -2, 0, 0, 0, 270, 0).data("side", "side-4"));
                element.append(this.createElementFace(textures.random(), grid, 0, 0, grid / -2, 180, 0, 0).data("side", "bottom"));

                return element;
            };

            Block.prototype.createElementFace = function(texture, unit, x, y, z, rx, ry, rz, additional) {
                var face = $("<div />");

                face.addClass("object");
                face.addClass("face");

                if (additional) {
                    face.addClass(additional);
                }

                face.css({
                    "background": "url(" + texture + ") 0px 0px",
                    "width": unit.toInt() + "px",
                    "height": unit.toInt() + "px",
                    "marginTop": "-" + (unit / 2).toInt() + "px",
                    "marginLeft": "-" + (unit / 2).toInt() + "px",
                    "transform": "translateX(" + x.toInt() + "px) translateY(" + y.toInt() + "px) translateZ(" + z.toInt() + "px) rotateX(" + rx.toInt() + "deg) rotateY(" + ry.toInt() + "deg) rotateZ(" + rz.toInt() + "deg)"
                });

                return face;
            };

            var surface = $("<div />");
            surface.addClass("object");
            surface.addClass("surface");

            for (var x = 0; x < 10; x++) {
                for (var y = 0; y < 10; y++) {
                    var block = new Block(x, y, -1);
                    surface.append(block.element);
                }
            }

            $(document.body).append(surface);

            $(document.body).on("click", ".face", function(e) {
                var side = $(this).data("side");
                var previous = $(this).closest(".block").data("block");

                console.log(side);

                if (side == "top") {
                    var next = new Block(previous.x, previous.y, previous.z + 1);
                    surface.append(next.element);
                }

                if (side == "side-1") {
                    var next = new Block(previous.x, previous.y + 1, previous.z);
                    surface.append(next.element);
                }

                if (side == "side-2") {
                    var next = new Block(previous.x, previous.y - 1, previous.z);
                    surface.append(next.element);
                }

                if (side == "side-3") {
                    var next = new Block(previous.x + 1, previous.y, previous.z);
                    surface.append(next.element);
                }

                if (side == "side-4") {
                    var next = new Block(previous.x - 1, previous.y, previous.z);
                    surface.append(next.element);
                }

                if (side == "bottom") {
                    var next = new Block(previous.x, previous.y, previous.z - 1);
                    surface.append(next.element);
                }
            });

            var sx = 60;
            var sy = 0;
            var sz = 60;

            $(".rotate-x").on("change", function(e) {
                sx = this.value;

                surface.css({
                    "transform": "rotateX(" + sx + "deg) rotateY(" + sy + "deg) rotateZ(" + sz + "deg)"
                });
            });

            $(".rotate-y").on("change", function(e) {
                sy = this.value;

                surface.css({
                    "transform": "rotateX(" + sx + "deg) rotateY(" + sy + "deg) rotateZ(" + sz + "deg)"
                });
            });

            $(".rotate-z").on("change", function(e) {
                sz = this.value;

                surface.css({
                    "transform": "rotateX(" + sx + "deg) rotateY(" + sy + "deg) rotateZ(" + sz + "deg)"
                });
            });
        </script>
    </body>
</html>
