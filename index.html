<!doctype html>
<html>
    <head>
        <style>
            .object {
                position: absolute;
                left: 50%;
                top: 50%;
                transform-style: preserve-3d;
                transform-origin: 50% 50% 50%;
                backface-visibility: hidden;
            }

            .surface {
                margin-top: -250px;
                margin-left: -250px;
                width: 500px;
                height: 500px;
                /*border: solid 2px rgba(0, 0, 0, 0.3);
                background: rgba(0, 0, 0, 0.2);*/
                backface-visibility: visible;
                transform: rotateX(60deg) rotateY(0) rotateZ(60deg);
            }

            /* DEBUG â†“ */

            .face {
                outline: 1px solid #000;
                background: #DDD !important;
                backface-visibility: visible;
            }

            /*.face {
                border: solid 1px transparent;
                box-sizing: border-box;
            }*/

            /*.tile {
                background: red !important;
            }*/

            /*.block:hover .face {
                border: solid 1px red !important;
            }*/
        </style>
    </head>
    <body>
        <script>
            Array.prototype.random = function() {
                return this[Math.floor(Math.random() * this.length)];
            };

            var grid = 64;

            var textures = {
                "top": [
                    "resources/textures/64x64/dirt-top-1.png",
                    "resources/textures/64x64/dirt-top-2.png",
                    "resources/textures/64x64/dirt-top-3.png"
                ],
                "side": [
                    "resources/textures/64x64/dirt-side-1.png",
                    "resources/textures/64x64/dirt-side-2.png",
                    "resources/textures/64x64/dirt-side-3.png",
                    "resources/textures/64x64/dirt-side-4.png",
                    "resources/textures/64x64/dirt-side-5.png",
                ],
                "bottom": [
                    "resources/textures/64x64/dirt-top-1.png",
                    "resources/textures/64x64/dirt-top-2.png",
                    "resources/textures/64x64/dirt-top-3.png"
                ]
            };

            function Block(x, y, z, rx, ry, rz, type) {
                this.x = x || 0;
                this.y = y || 0;
                this.z = z || 0;
                this.rx = rx || 0;
                this.ry = ry || 0;
                this.rz = rz || 0;

                this.type = type || "dirt";

                this.ox = 0;
                this.oy = 0;
                this.oz = 32;
                this.orx = 0;
                this.ory = 0;
                this.orz = 0;

                this.element = this.createElement();
                this.update();
            }

            Block.prototype.update = function() {
                var x = this.x + this.ox;
                var y = this.y + this.oy;
                var z = this.z + this.oz;

                var rx = this.rx + this.orx;
                var ry = this.ry + this.ory;
                var rz = this.rz + this.orz;

                var styles = "transform: translate3d(" + x + "px, " + y + "px, " + z + "px) rotate3d(" + rx + "deg, " + ry + "deg, " + rz + "deg); ";

                console.log("element styles", styles);

                this.element.style.cssText = styles;
            };

            Block.prototype.createElement = function() {
                var element = document.createElement("div");

                element.className = "object block";

                element.appendChild(this.createElementFace(textures.top.random(), 64, 0, 32, 0, 0, 0, 0));
                element.appendChild(this.createElementFace(textures.top.random(), 64, 0, -32, 0, 0, 0, 0));

                return element;
            };

            Block.prototype.createElementFace = function(t, u, x, y, z, rx, ry, rz) {
                var face = document.createElement("div");

                face.className = "object face";

                var styles =
                    "background: url(" + t + ") 0px 0px; " +
                    "width: " + parseInt(u, 10) + "px; " +
                    "height: " + parseInt(u, 10) + "px; " +
                    "marginTop: -" + parseInt(u / 2, 10) + "px; " +
                    "marginLeft: -" + parseInt(u / 2, 10) + "px; " +
                    "transform: translate3d(" + parseInt(x, 10) + "px, " + parseInt(y, 10) + "px, " + parseInt(z, 10) + "px) rotate3d(" + parseInt(rx, 10) + "deg, " + parseInt(ry, 10) + "deg, " + parseInt(rz, 10) + "deg); "

                console.log("face styles", styles);

                face.style.cssText = styles;

                return face;
            };

            var block1 = new Block();

            var surface = document.createElement("div");
            surface.className = "object surface";

            surface.appendChild(block1.element);

            document.body.appendChild(surface);

            // function createFace(w, h, x, y, z, rx, ry, rz, texture, className) {
            //     var face = document.createElement("div");
            //
            //     face.className = "object face " + className;
            //
            //     face.style.cssText =
            //         "background: url(" + texture + ") 0px 0px;" +
            //         "width:" + w.toFixed(2) + "px;" +
            //         "height:" + h.toFixed(2) + "px;" +
            //         "margin-top: -" + (h / 2).toFixed(2) + "px;" +
            //         "margin-left: -" + (w / 2).toFixed(2) + "px;" +
            //         "transform: translate3d(" + x.toFixed(2) + "px," + y.toFixed(2) + "px," + z.toFixed(2) + "px)" +
            //         "rotateX(" + rx.toFixed(2) + "rad) rotateY(" + ry.toFixed(2) + "rad) rotateY(" + rz.toFixed(2) + "rad);"
            //
            //     return face;
            // }
            //
            // function createBlock(type) {
            //     var textures = TEXTURES[type];
            //
            //     var block = document.createElement("div");
            //     block.className = "object block";
            //
            //     block.appendChild(createFace(64, 64, 0, -32, 0, Math.PI / 2, 0, 0, textures.tops.random(), "top"));
            //     block.appendChild(createFace(64, 64, 0, 32, 0, -Math.PI / 2, 0, 0, textures.tops.random(), "bottom"));
            //     block.appendChild(createFace(64, 64, 32, 0, 0, 0, Math.PI / 2, 0, textures.sides.random(), "side-1"));
            //     block.appendChild(createFace(64, 64, -32, 0, 0, 0, -Math.PI / 2, 0, textures.sides.random(), "side-2"));
            //     block.appendChild(createFace(64, 64, 0, 0, 32, 0, 0, 0, textures.sides.random(), "side-3"));
            //     block.appendChild(createFace(64, 64, 0, 0, -32, 0, Math.PI, 0, textures.sides.random(), "side-4"));
            //
            //     return block;
            // }
            //
            // var surface = document.createElement("div");
            // surface.className = "object surface";
            //
            // var block = createBlock("dirt");
            //
            // block.x = 0;
            // block.y = 0;
            // block.z = 32;
            // block.rx = -90;
            // block.ry = 0;
            // block.rz = 0;
            //
            // block.style.cssText =
            //     "transform:" +
            //         "translate3d(" + block.x + "px, " + block.y + "px, " + block.z + "px)" +
            //         "rotate3d(" + block.rx + "deg, " + block.ry + "deg, " + block.rz + "deg)";
            //
            // surface.appendChild(block);
            //
            // document.body.appendChild(surface);
            //
            // var startX = null;
            // var startY = null;
            // var dragging = false;
            // var grid = 64;
            //
            // for (var x = 0; x < surface.offsetWidth; x += grid) {
            //     for (var y = 0; y < surface.offsetHeight; y += grid) {
            //         var tile = document.createElement("div");
            //         tile.className = "object tile";
            //         tile.style.cssText =
            //             "top: " + y + "px;" +
            //             "left: " + x + "px;" +
            //             "transform: translate3d(0, 0, 1px)";
            //
            //             console.log(tile.style.cssText);
            //
            //         surface.appendChild(tile);
            //     }
            // }
            //
            // block.addEventListener("mousedown", function(e) {
            //     startX = e.clientX;
            //     startY = e.clientY;
            //     dragging = true;
            // });
            //
            // block.addEventListener("mouseup", function(e) {
            //     dragging = false;
            // });
            //
            // block.addEventListener("mousemove", function(e) {
            //     if (!dragging) {
            //         return;
            //     }
            //
            //     // var newX = Math.round((startX - e.clientX) / grid) * grid;
            //     // var newY = Math.round((startY - e.clientY) / grid) * grid;
            //     //
            //     // console.log(newX, newY);
            //
            //     block.style.cssText = "transform: translate3d(" + (block.x + e.clientX) + "px, " + (block.y + e.clientY) + "px, 32px)";
            // });
        </script>
    </body>
</html>
